---
layout: post
title: MySQL 数据库相关知识整理
categories: Database
description: MySQL 数据库相关知识整理
keywords: database, mysql, 原理, 数据库
---

MySQL 数据库在互联网业务中的地位无需多言，本文从各个方面整理 MySQL 数据库的知识点。

## 底层原理

MySQL 底层是使用了哪些技术，使得其具备高性能的特性呢？

### 存储引擎

MySQL 的存储引擎主要包括：

- MyISAM
  - 低版本默认引擎
  - 支持全文检索、压缩、空间函数
  - 不支持事务和行级锁
  - 对全表加锁
- InnoDB
  - 高版本默认引擎
  - 默认的事务性引擎
  - 性能优越、自动崩溃回复特性
  - 采用 MVCC 实现高并发、实现不同隔离级别
  - 基于聚簇索引建立表
  - 采用可预测性预读的技术从磁盘加载数据
- Archive/Memory/CSV 等

### 磁盘数据存储体系和 Linux

- 磁盘结构

![image](/images/posts/disk_region.png)

> 存储容量 ＝ 磁头数 × 磁道(柱面)数 × 每道扇区数 × 每扇区字节数
>
> 需注意现代硬盘数据的密度都均匀一致，这样越是外圈的磁道扇区就越多，存储的数据量就越大。

- 磁盘数据加载耗时

磁盘读取数据的耗时主要在以下各方面：

|耗时原因|说明|
|:---|:---|
|寻道时间|把磁头移动到数据所在磁道位置耗时|
|旋转延迟|移动具体磁道至磁头位置耗时，主要取决于转速|
|数据传输|完成数据传输所需时间|

- Linux 内核的设备抽象

Linux 内核将设备分为三类：

|设备类型|说明|举例|
|:---|:---|:---|
|字符设备|1.顺序访问 2.以字符为基本单位 3.无缓存|常见的外设|
|块设备|1.随机访问 2.以块为存储的基本单位 3.有缓存|常见的存储设备|
|网络设备|将外通信抽象为设备机制，采用 socket 实现| socket + 设备驱动 + 网络协议|

> 每一个字符设备或块设备都在 /dev 目录下对应一个设备文件。通过设备文件（或称设备节点）来使用驱动程序操作字符设备和块设备。

|概念|说明|大小|
|:---|:---|:---|
|扇区|磁盘存储数据最小单元|512 bytes|
|块/簇|(widows/linux) 文件系统最小单元|4K bytes|
|Page|内存与操作系统交互的最小单元||

注：因此一个实际大小为 1 字节的文件，在文件系统中却占用了 4K(4096) 字节的空间。

InnoDB 存储引擎的最小存储单元是页，一个页的大小是 16K。可以查看后缀为 ibd 的数据文件，其大小始终为 16K(10384) 字节的整数倍。

> 对应参数 `innodb_page_size`

### B-Tree

B-tree（B树）的每个节点可以拥有2个以上的子节点，是一颗多路平衡查找树，它广泛应用于数据库索引和文件系统中。

### B+Tree

每一个叶子节点都包含指向下一个叶子节点的指针，从而方便叶子节点的范围遍历

每个节点的指针上限为2d而不是2d+1

内节点不存储data，只存储key；叶子节点不存储指针。

每个叶子节点增加一个指向相邻叶子节点的指针，就形成了带有顺序访问指针的B+Tree。

## 数据库事务、隔离级别、存在问题
## 索引
## 查询优化
## explain 详解
## join 优化注意点
### 索引失败分析
## mvcc
## redo、undo
## 分库分表
## 弹性扩容
